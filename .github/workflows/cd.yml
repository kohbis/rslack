name: CD

on:
  pull_request:

jobs:
  spec:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Run fmt check
        run: cargo fmt -- --check
      # - name: Run tests
      #   run: cargo test --verbose

  tagging:
    runs-on: ubuntu-20.04
    needs: spec
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Extract branch name
        id: extract_branch
        run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
      - name: Check branch name
        id: check_branch
        run: |
          if [[ ${{ github.head_ref }} =~ ^release\/v[0-9]+\.[0-9]+\.[0-9]+.*$ ]]; then
            echo ::set-output name=match::true
          fi
      - name: Git Tag
        if: steps.check_branch.outputs.match == true && github.event.pull_request.merged == false
        run: |
          echo "Tag is a match"

